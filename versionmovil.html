<!doctype html>
                            <head>
                                <meta charset='utf-8'>
                              
<meta name="viewport" content="width=device-width, initial-scale=1.0">

                                <title>Snippet - BBBootstrap</title>
                                <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css' rel='stylesheet'>
                       
                            
                          

   <link rel="stylesheet" href="css/responsivemovil.css">


<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">


<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
      <link rel="stylesheet" href="css/estilosmovil.css">
      <script>
document.addEventListener("DOMContentLoaded", function () {
    function checkScreenWidth() {
        let width = window.innerWidth;

        if (width <= 991) {
            // Si es menor o igual a 991px, redirigir a la versi√≥n m√≥vil
            if (!window.location.href.includes("versionmovil.html")) {
                window.location.href = "versionmovil.html";
            }
        } else {
            // Si es mayor a 991px, redirigir a la versi√≥n PC
            if (!window.location.href.includes("index.html")) {
                window.location.href = "index.html";
            }
        }
    }

    checkScreenWidth(); // Verificar al cargar la p√°gina

    // Detectar cambios en el tama√±o de la pantalla
    window.addEventListener("resize", checkScreenWidth);
});
</script>

</head>
<body>
    <div id="fixedHeaderContainer">
    <div class="header">
        <h4>Buscador B√≠blico</h4>
        <div class="header-icons">
            <i class="fas fa-cog"></i>
            <i class="fas fa-ellipsis-v"></i>
        </div>
    </div>
    <div class="search-bar-container">
                <button class="btn btn-success" id="OpenMod">
            <i class="fas fa-book" id="dropdownMenu"></i>
        </button>
    <div class="search-bar">
        <input type="text" id="searchInput" class="form-control" placeholder="Escribe tu b√∫squeda...">
        <button class="btn btn-success" id="searchButton">
        </button>
    </div>


     

   <div id="fullscreenModal" class="fullscreen-modal">
    <div class="modal-content-custom">
        <div id="librosContainer">
            <a href="#" data-libro="Marcos">Seg√∫n Marcos</a>
            <a href="#" data-libro="Romanos">Carta a los Romanos</a>
            <a href="#" data-libro="G√°latas">Carta a los G√°latas</a>
            <a href="#" data-libro="1Tesalonicenses">1 Tesalonicenses</a>
            <a href="#" data-libro="2Tesalonicenses">2 Tesalonicenses</a>
            <a href="#" data-libro="Hebreos">Carta a los Hebreos</a>
            <a href="#" data-libro="Apocalipsis">Revelaci√≥n Apocalipsis</a>
        </div>
        
        <!-- Contenedor para mostrar los cap√≠tulos -->
        <div id="capitulosContainer" style="display: none;"></div>
        
        <button class="close-btn" id="closeModal">Cerrar</button>
    </div>
</div>


<div id="sidebarconteo">
    <div id="searchTermContainer" style="font-weight: bold; margin-bottom: 10px;"></div>
    <h5>Resultados</h5>
    <ul id="countResults" style="
        margin-top: -5px;
        list-style-type: none;
        padding: 0;
        margin-bottom: 10px;
        width: 100%;
    "></ul>
</div>

<!-- Bot√≥n para abrir/cerrar sidebar -->
<div class="toggle-btn" onclick="toggleSidebar()">‚ò∞</div>

<script>

    document.querySelector(".fa-cog").addEventListener("click", function() {
    this.classList.toggle("clicked");
});

    function toggleSidebar() {
        let sidebar = document.getElementById("sidebarconteo");
        sidebar.classList.toggle("active");
    }

    document.addEventListener("DOMContentLoaded", function () {
    let settingsIcon = document.querySelector(".fas.fa-cog");
    let settingsMenu = document.getElementById("settingsMenu");

    settingsIcon.addEventListener("click", function (event) {
        event.stopPropagation(); // Evita que el clic cierre el men√∫ inmediatamente
        settingsMenu.style.display = (settingsMenu.style.display === "block") ? "none" : "block";
    });

    document.addEventListener("click", function (event) {
        if (!settingsMenu.contains(event.target) && event.target !== settingsIcon) {
            settingsMenu.style.display = "none";
        }
    });
});
function toggleNavigationButtons() {
    let isEnabled = document.getElementById("toggleNavButtons").checked;

    // Guardar preferencia en localStorage
    localStorage.setItem("navButtonsVisible", isEnabled);

    // Obtener los botones de navegaci√≥n
    let buttons = document.querySelectorAll("#prevChapterBtn, #nextChapterBtn, #prevChapterBtnBottom, #nextChapterBtnBottom");

    buttons.forEach(button => {
        if (isEnabled) {
            button.style.position = "relative";  // Mostrar en su posici√≥n normal
            button.style.left = "0";  
            button.style.visibility = "visible"; 
            button.style.opacity = "1"; 
            button.style.pointerEvents = "auto"; // Permitir interacci√≥n
            button.style.transition = "opacity 0.3s ease-out";
        } else {
            button.style.position = "absolute"; // Ocultar fuera de pantalla
            button.style.left = "-9999px"; 
            button.style.visibility = "hidden"; 
            button.style.opacity = "0"; 
            button.style.pointerEvents = "none"; // Evitar clics
        }
    });
}


// Restaurar configuraci√≥n al cargar la p√°gina
document.addEventListener("DOMContentLoaded", function () {
    let storedValue = localStorage.getItem("navButtonsVisible");

    // Si no hay valor guardado, activar por defecto
    let isEnabled = storedValue === null ? true : storedValue === "true";

    // Aplicar el estado del toggle en el checkbox
    document.getElementById("toggleNavButtons").checked = isEnabled;

    // Aplicar la configuraci√≥n
    toggleNavigationButtons();
});



// Asegurar que se aplique al cambiar de cap√≠tulo
document.addEventListener("chapterChanged", toggleNavigationButtons);



</script>
 
         



<div class="settings-menu" id="settingsMenu">
    <label class="switch">
        <input type="checkbox" id="toggleNavButtons" onchange="toggleNavigationButtons()">
        <span class="slider"></span>
    </label>
    <span style="font-size: 14px;">Ver botones / Touch</span>

    <label for="fontSelector">Fuente:</label>
    <select id="fontSelector" class="config-dropdown">
        <option value="Arial">Arial</option>
        <option value="Verdana">Verdana</option>
        <option value="Times New Roman">Times New Roman</option>
    </select>

    <label for="fontSizeSelector">Tama√±o:</label>
<select id="fontSizeSelector" class="config-dropdown">
    <option value="12">12</option>
    <option value="14">14</option>
    <option value="16">16</option>
    <option value="20">20</option>
</select>

</div>
<div class="settings-menu" id="menuOpciones">
    <h6>Opciones</h6>
    <label class="switch">
        <input type="checkbox" id="toggleDarkModeSwitch">
        <span class="slider round"></span>
    </label>
    <span style="font-size: 14px;">Modo Oscuro</span>
</div>

</div>

</div>


<script>
document.querySelector(".fa-ellipsis-v").addEventListener("click", function(event) {
    event.stopPropagation();
    let menu = document.getElementById("menuOpciones");
    menu.style.display = (menu.style.display === "block") ? "none" : "block";
});

document.addEventListener("click", function(event) {
    let menu = document.getElementById("menuOpciones");
    if (!menu.contains(event.target) && event.target !== document.querySelector(".fa-ellipsis-v")) {
        menu.style.display = "none";
    }
});

document.getElementById("toggleDarkModeSwitch").addEventListener("change", function() {
    document.body.classList.toggle("dark-mode");

    let header = document.querySelector(".header");
    let botones = document.querySelectorAll("button.btn-success, .toggle-btn");

    if (document.body.classList.contains("dark-mode")) {
        header.style.backgroundColor = "#222";
        header.style.color = "#fff";
        botones.forEach(btn => {
            btn.style.backgroundColor = "#000";
            btn.style.color = "#fff";
            btn.style.border = "1px solid #fff";
        });
        localStorage.setItem("modoOscuro", "true"); // Guardar preferencia
    } else {
        header.style.backgroundColor = "";
        header.style.color = "";
        botones.forEach(btn => {
            btn.style.backgroundColor = "";
            btn.style.color = "";
            btn.style.border = "";
        });
        localStorage.setItem("modoOscuro", "false"); // Guardar preferencia
    }
});

document.addEventListener("DOMContentLoaded", function () {
    let modoOscuroActivo = localStorage.getItem("modoOscuro") === "true";
    let switchModoOscuro = document.getElementById("toggleDarkModeSwitch");

    if (modoOscuroActivo) {
        document.body.classList.add("dark-mode");
        switchModoOscuro.checked = true;

        let header = document.querySelector(".header");
        let botones = document.querySelectorAll("button.btn-success, .toggle-btn");

        header.style.backgroundColor = "#222";
        header.style.color = "#fff";
        botones.forEach(btn => {
            btn.style.backgroundColor = "#000";
            btn.style.color = "#fff";
            btn.style.border = "1px solid #fff";
        });
    }
});



</script>

<!-- Resultados -->

    <ul id="results" style="margin-top:130px !important; padding-bottom:80px; background-color:#e5ddd5;" class="list-group col-12 mt-3">
    </ul>

<div id="sidebar">
    <h5>NA28</h5>
    <p>Aqu√≠ ir√° el contenido del aparato critico de cada verso disponible, busca algun verso que te interese y si encuentras     <i class="bi bi-bookmark"></i> solo da click para leerlo. </p>
    <br>
    <p>üìñ La NA28 (Nestle-Aland 28) es una edici√≥n del Nuevo Testamento en griego, usada por acad√©micos y traductores para estudiar el texto original de la Biblia. Es considerada una de las versiones m√°s precisas, ya que se basa en los manuscritos m√°s antiguos y confiables.  </p>

    <br>
    <br>
    <br>
</div>
<div id="sidebarparalelo">
  <h5>Biblia Paralela</h5> <!-- Bot√≥n para ocultar/mostrar b√∫squeda -->
<!-- Bot√≥n para ocultar/mostrar b√∫squeda -->
<button id="toggleSearchOptions" class="toggle-btn-sidebar">
    <i class="fas fa-chevron-up"></i>
</button>

<!-- Contenedor de los filtros de b√∫squeda -->
<div id="searchOptionsContainer">
    <label for="versionSelect">Versi√≥n:</label>
    <select id="versionSelect">
        <option value="RVR1960">RVR1960</option>
        <option value="BTX4">BTX4</option>
    </select>

    <label for="libroSelect">Libro:</label>
    <select id="libroSelect">
        <option value="">-- Elige versi√≥n primero --</option>
    </select>

    <label for="capituloSelect">Cap√≠tulo:</label>
    <select id="capituloSelect">
        <option value="">-- Elige libro primero --</option>
    </select>

    <!-- Botones de b√∫squeda y sincronizaci√≥n -->
    <button id="btnCargar">Buscar</button>
    <button id="btnSync">Sincronizar</button>
</div>

<!-- Este div SIEMPRE estar√° visible -->
<div id="contenidoBiblia" style="margin-top:20px;"></div>

</div>

<div id="sidebarcomentarios">
<div id="contenedorComentarios">
        <p id="mensajeNoComentarios">No hay comentarios</p>
    </div>
</div>

    
    <div class="bottom-nav">
        <a href="https://www.torah-con-yehoshua-hamashiaj.com">
    <i class="fas fa-home"></i>
</a>

        <i class="fas fa-book" id="imgMaterial"></i>  <!-- aparato critico na28 -->
<i class="fas fa-message" id="toggleComentarios"></i>         <!-- √çcono de comentarios -->
        <i class="fas fa-book-open" id="sidebar2"></i>  <!-- biblia paralela -->
    </div>
    
    <div class="floating-button" id="flotante" style="z-index: 1001;">
        <i class="fas fa-plus"></i>
    </div>

   <script src="js/cargarcomentariosmovil.js"></script>
        <script>


document.getElementById("sidebar2").addEventListener("click", function() {
    let sidebar = document.getElementById("sidebarparalelo");
    sidebar.classList.toggle("active"); // Alternar la clase para mostrar/ocultar
});




document.addEventListener("DOMContentLoaded", function () {
    let boton = document.getElementById("flotante");
    let menu = document.querySelector(".bottom-nav");

    boton.addEventListener("click", function () {
        menu.classList.toggle("hidden"); // Alternar clase para ocultar/mostrar
    });
});




            /* codigo del menu de libros*/
        document.getElementById("OpenMod").addEventListener("click", function() {
            document.getElementById("fullscreenModal").style.display = "flex";
        });

       document.getElementById("closeModal").addEventListener("click", function() {
    document.getElementById("fullscreenModal").style.display = "none";
});

// Evento para abrir el modal y resetear la vista
document.getElementById("OpenMod").addEventListener("click", () => {
    let modal = document.getElementById("fullscreenModal");
    let librosContainer = document.getElementById("librosContainer");
    let capitulosContainer = document.getElementById("capitulosContainer");

    // Restaurar la vista inicial
    librosContainer.style.display = "block";  // Mostrar la lista de libros
    capitulosContainer.style.display = "none"; // Ocultar los cap√≠tulos previos

    // Mostrar el modal
    modal.style.display = "flex";
});

// Manejar la selecci√≥n de libros y mostrar cap√≠tulos
document.querySelectorAll(".modal-content-custom a").forEach(item => {
    item.addEventListener("click", async function(event) {
        event.preventDefault(); // Evitar recarga

        let libroSeleccionado = this.dataset.libro;
        let capitulosContainer = document.getElementById("capitulosContainer");
        let librosContainer = document.getElementById("librosContainer");

        // Cargar los datos si a√∫n no se han descargado
        await fetchAllJsonData();
        
        // Verificar si el libro existe en los datos cargados
        if (!bibliaDatos[libroSeleccionado]) {
            capitulosContainer.innerHTML = `<p>No se encontraron cap√≠tulos para ${libroSeleccionado}.</p>`;
            return;
        }

        // Ocultar la lista de libros y mostrar la de cap√≠tulos
        librosContainer.style.display = "none";
        capitulosContainer.style.display = "block";

        // Generar la lista de cap√≠tulos
        let fragment = document.createDocumentFragment();
        Object.keys(bibliaDatos[libroSeleccionado]).forEach(capitulo => {
            let button = document.createElement("button");
            button.textContent = `Cap√≠tulo ${capitulo}`;
            button.classList.add("capitulo-btn");
            button.addEventListener("click", () => {
                showFullChapter(libroSeleccionado, capitulo);
                
                // Cerrar el modal al seleccionar un cap√≠tulo
                document.getElementById("fullscreenModal").style.display = "none";
            });
            fragment.appendChild(button);
        });

        // Limpiar y agregar los cap√≠tulos al modal
        capitulosContainer.innerHTML = "";
        capitulosContainer.appendChild(fragment);

        // Agregar un bot√≥n para volver a la lista de libros
        let backButton = document.createElement("button");
        backButton.textContent = "‚Üê Volver a libros";
        backButton.classList.add("back-btn");
        backButton.addEventListener("click", () => {
            capitulosContainer.style.display = "none";
            librosContainer.style.display = "block";
        });

        capitulosContainer.appendChild(backButton);
    });
});


document.addEventListener("DOMContentLoaded", () => {
    let touchStartX = 0;
    let touchEndX = 0;

    function checkSwipe() {
        if (!currentBook || !currentChapter) return;

        let prevButton = document.getElementById("prevChapterBtn");
        let nextButton = document.getElementById("nextChapterBtn");

        let prevVisible = prevButton && prevButton.style.display !== "none";
        let nextVisible = nextButton && nextButton.style.display !== "none";

        if (touchStartX - touchEndX > 50 && nextVisible) {
            showNextChapter();
        } else if (touchEndX - touchStartX > 50 && prevVisible) {
            showPreviousChapter();
        }
    }

    document.addEventListener("touchstart", (e) => {
        touchStartX = e.changedTouches[0].screenX;
    });

    document.addEventListener("touchend", (e) => {
        touchEndX = e.changedTouches[0].screenX;
        checkSwipe();
    });
});


        async function mostrarCapitulos(libro) {
  const datos = await fetchAllJsonData();
  if (!datos[libro]) return;
  
  let capitulosHtml = Object.keys(datos[libro])
    .map(cap => `<a href="#" onclick="showFullChapter('${libro}', '${cap}')">Cap√≠tulo ${cap}</a>`)
    .join("");

  document.getElementById("results").innerHTML = `<div class="chapter-list">${capitulosHtml}</div>`;
}
    </script>
 <script>

// URLs de los JSONs
const urls = [
  "https://raw.githubusercontent.com/Angelos2024/torah-Yehoshua/main/Marcos.json",
  "https://raw.githubusercontent.com/Angelos2024/torah-Yehoshua/main/galatas.json",
  "https://raw.githubusercontent.com/Angelos2024/torah-Yehoshua/main/Hebreos.json",
  "https://raw.githubusercontent.com/Angelos2024/torah-Yehoshua/main/1_Tesalonicenses.json",
  "https://raw.githubusercontent.com/Angelos2024/torah-Yehoshua/main/2_Tesalonicenses.json",
  "https://raw.githubusercontent.com/Angelos2024/torah-Yehoshua/main/Romanos.json",
  "https://raw.githubusercontent.com/Angelos2024/torah-Yehoshua/main/Apocalipsis.json"
];

// Elementos del DOM
const searchInput = document.getElementById("searchInput");
const searchButton = document.getElementById("searchButton");
const resultsContainer = document.getElementById("results");
const countResultsContainer = document.getElementById("countResults");

// Cargar todos los JSONs en memoria
let bibliaDatos = {};

async function fetchJsonData(url) {
  try {
    const response = await fetch(url);
    if (!response.ok) throw new Error(`Error al cargar JSON: ${response.status}`);
    return await response.json();
  } catch (error) {
    console.error(`Error:`, error);
    return null;
  }
}

async function fetchAllJsonData() {
  if (Object.keys(bibliaDatos).length) return bibliaDatos; // Usa cach√© si ya est√° cargado
  const responses = await Promise.all(urls.map(url => fetchJsonData(url)));
  responses.forEach(data => { if (data) Object.assign(bibliaDatos, data); });
  return bibliaDatos;
}


// Mapa de abreviaturas de libros
const libroMap = {
   gal: "g√°latas", Gal: "G√°latas",
   "galatas": "G√°latas", "Galatas":"G√°latas", "galatas": "G√°latas",
    heb: "hebreos", Heb: "Hebreos", "hebreos": "Hebreos", "Hebreos": "Hebreos", "HEBREOS":"Hebreos",
    "1 tes": "1Tesalonicenses", "1tes": "1Tesalonicenses",
    "1 tesa": "1Tesalonicenses", "1Tesa": "1Tesalonicenses",
    "1 tesalonicenses": "1Tesalonicenses", 
    "2 tes": "2Tesalonicenses", "2tes": "2Tesalonicenses",
    "2 tesa": "2Tesalonicenses", "2Tesa": "2Tesalonicenses",
    "2 tesalonicenses": "2Tesalonicenses",
    "Romanos": "Romanos", "romanos": "Romanos", "Rom": "Romanos", "rom": "Romanos", "ROMANOS":"Romanos", "ROM": "Romanos", "Marcos": "Marcos", "marcos":"Marcos", "MARCOS":"Marcos", "marc": "Marcos", "Mc": "Marcos", "Mar":"Marcos", "MAR": "Marcos", "mar":"Marcos", "Ap": "Apocalipsis", "ap":"Apocalipsis", "apocalipsis":"Apocalipsis", "APOCALIPSIS":"Apocalipsis", "Apoc":"Apocalipsis", "apoc":"Apocalipsis", "APOC":"Apocalipsis","AP":"Apocalipsis"
  };

// üî• Variables globales para la versi√≥n principal
let currentBook = null;
let currentChapter = null;

// Funci√≥n de b√∫squeda
async function searchVerses(query) {
    if (!query || typeof query !== "string") {
        console.error("searchVerses: query es inv√°lido", query);
        return;
    }

    const datos = await fetchAllJsonData();
    if (!datos) return;

    // Resetear contenedores
    resultsContainer.innerHTML = "";
    countResultsContainer.innerHTML = "";

    let tituloCapitulo = document.getElementById("tituloCapitulo");
    if (tituloCapitulo) {
        tituloCapitulo.style.display = "none"; 
    }

    const normalizedQuery = query
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();

    const match = normalizedQuery.match(/^([\w\s]+)\s(\d+)(?::(\d+)(?:-(\d+))?)?$/);
    if (match) {
        let libro = match[1].trim();
        const capitulo = match[2];

        libro = libroMap[libro] || libro;
        const libroEncontrado = Object.keys(datos).find(key =>
            key.toLowerCase() === libro.toLowerCase()
        );

        if (libroEncontrado && datos[libroEncontrado][capitulo]) {
            currentBook = libroEncontrado;
            currentChapter = parseInt(capitulo, 10);

            showFullChapter(libroEncontrado, capitulo);
            return;
        }
    }

    if (!query) return;

    try {
        const palabraRegex = new RegExp(`(${query})`, "gi");
        let resultados = [];

        Object.keys(datos).forEach(libro => {
            Object.keys(datos[libro]).forEach(capitulo => {
                Object.entries(datos[libro][capitulo]).forEach(([versiculo, texto]) => {
                    const textoNormalizado = texto
                        .normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
                    if (textoNormalizado.includes(normalizedQuery)) {
                        const textoResaltado = texto.replace(
                            palabraRegex,
                            "<span style='background-color: #ffeb3b; font-weight: bold;'>$1</span>"
                        );
                        resultados.push(
                            `<li>${libro} ${capitulo}:${versiculo} - ${textoResaltado}
                              <span class="full-chapter-link" onclick="showFullChapter('${libro}', '${capitulo}')">Leer cap√≠tulo completo</span>
                            </li>`
                        );
                    }
                });
            });
        });

        resultsContainer.innerHTML = resultados.length > 0 ? resultados.join("") : "<li>No se encontraron coincidencias.</li>";
    } catch (error) {
        console.error("Error en palabraRegex:", error);
    }
}



function showFullChapter(libro, capitulo) {
    fetchAllJsonData().then(datos => {
        if (!datos[libro] || !datos[libro][capitulo]) return;

        currentBook = libro;
        currentChapter = parseInt(capitulo, 10);

        const versiculos = Object.entries(datos[libro][capitulo])
            .map(([versiculo, texto]) => {
                const claveMapa = `${libro} ${capitulo}:${versiculo}`;

                const botonBookmark = na28Map[claveMapa]
                    ? `<button class="bookmark-btn" onclick="cargarNA28('${libro}', '${capitulo}', '${versiculo}')">
                           <i class="bi bi-bookmark"></i>
                       </button>`
                    : "";

                return `<li><span>${versiculo}. ${texto}</span>${botonBookmark}</li>`;
            })
            .join("");

        resultsContainer.innerHTML = `
            <div class="chapter-navigation">
                <button id="prevChapterBtn" onclick="showPreviousChapter()">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button id="nextChapterBtn" onclick="showNextChapter()">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <h2 id="tituloCapitulo">${libro} ${capitulo}</h2>
            <ul>${versiculos}</ul>
<div class="chapter-navigation">
                <button id="prevChapterBtnBottom" onclick="showPreviousChapter()">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button id="nextChapterBtnBottom" onclick="showNextChapter()">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        `;

        document.getElementById("tituloCapitulo").style.display = "block";
        toggleNavigationButtons();
        cargarComentariosCapitulo(libro, capitulo);
        aplicarEstilos(); // üî• Aplicar estilos despu√©s de cambiar el contenido
    });
}








function showPreviousChapter() {
    fetchAllJsonData().then(datos => {
        if (!currentBook || !currentChapter) return;
        let prevChapter = (currentChapter - 1).toString();

        if (datos[currentBook][prevChapter]) {
            showFullChapter(currentBook, prevChapter);
        }
    });
}

function showNextChapter() {
    fetchAllJsonData().then(datos => {
        if (!currentBook || !currentChapter) return;
        let nextChapter = (currentChapter + 1).toString();

        if (datos[currentBook][nextChapter]) {
            showFullChapter(currentBook, nextChapter);
        }
    });
}



function updateNavigationButtons(datos) {
    let prevButton = document.getElementById("prevChapterBtn");
    let nextButton = document.getElementById("nextChapterBtn");
    let prevButtonBottom = document.getElementById("prevChapterBtnBottom");
    let nextButtonBottom = document.getElementById("nextChapterBtnBottom");

    let prevChapter = (currentChapter - 1).toString();
    let nextChapter = (currentChapter + 1).toString();

    console.log(`Libro actual: ${currentBook}, Cap√≠tulo actual: ${currentChapter}`);
    console.log(`Cap√≠tulo anterior: ${prevChapter}, Cap√≠tulo siguiente: ${nextChapter}`);

    // Si hay un cap√≠tulo anterior, mostrar botones prev
    if (datos[currentBook][prevChapter]) {
        prevButton.style.display = "inline-block";
        prevButtonBottom.style.display = "inline-block";
    } else {
        prevButton.style.display = "none";
        prevButtonBottom.style.display = "none";
    }

    // Si hay un cap√≠tulo siguiente, mostrar botones next
    if (datos[currentBook][nextChapter]) {
        nextButton.style.display = "inline-block";
        nextButtonBottom.style.display = "inline-block";
    } else {
        nextButton.style.display = "none";
        nextButtonBottom.style.display = "none";
    }
}


// Eventos para la b√∫squeda
searchButton.addEventListener("click", () => {
  const query = searchInput.value.trim();
  if (query) {
    searchVerses(query);
    contarResultadosPorLibro(query); // Llamar a la funci√≥n de conteo
  }
});

searchInput.addEventListener("keypress", event => {
  if (event.key === "Enter") {
    const query = searchInput.value.trim();
    if (query) {
      searchVerses(query);
      contarResultadosPorLibro(query); // Llamar a la funci√≥n de conteo
    }
  }
});


</script>
<script>
document.getElementById("imgMaterial").addEventListener("click", function() {
    let sidebar = document.getElementById("sidebar");
    sidebar.classList.toggle("active"); // Alternar la clase para mostrar/ocultar
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    let boton = document.getElementById("flotante");
    let offsetX, offsetY, dragging = false;

    // Cargar la √∫ltima posici√≥n guardada y ajustarla si est√° fuera de la pantalla
    let savedPosition = localStorage.getItem("botonFlotantePos");
    if (savedPosition) {
        let { top, left } = JSON.parse(savedPosition);
        ajustarPosicionBoton(boton, top, left);
    }

    boton.addEventListener("touchstart", startDrag, false);
    boton.addEventListener("touchmove", drag, false);
    boton.addEventListener("touchend", stopDrag, false);

    boton.addEventListener("mousedown", startDrag, false);
    document.addEventListener("mousemove", drag, false);
    document.addEventListener("mouseup", stopDrag, false);

    function startDrag(e) {
        dragging = true;
        let event = e.type.includes("touch") ? e.touches[0] : e;
        offsetX = event.clientX - boton.getBoundingClientRect().left;
        offsetY = event.clientY - boton.getBoundingClientRect().top;
        boton.style.transition = "none"; // Quita la animaci√≥n al arrastrar
    }

    function drag(e) {
        if (!dragging) return;
        let event = e.type.includes("touch") ? e.touches[0] : e;
        let x = event.clientX - offsetX;
        let y = event.clientY - offsetY;

        ajustarPosicionBoton(boton, y, x);
    }

    function stopDrag() {
        if (!dragging) return;
        dragging = false;
        boton.style.transition = "all 0.2s ease-out"; // Animaci√≥n suave al soltar

        // Guardar la nueva posici√≥n en localStorage
        let position = {
            top: boton.offsetTop,
            left: boton.offsetLeft
        };
        localStorage.setItem("botonFlotantePos", JSON.stringify(position));
    }

    // **Funci√≥n para evitar que el bot√≥n quede fuera de la pantalla**
    function ajustarPosicionBoton(boton, top, left) {
        let maxX = window.innerWidth - boton.clientWidth - 10; // Margen de 10px
        let maxY = window.innerHeight - boton.clientHeight - 10;

        let newX = Math.max(10, Math.min(left, maxX)); // Evita salir por izquierda/derecha
        let newY = Math.max(10, Math.min(top, maxY));  // Evita salir por arriba/abajo

        boton.style.left = newX + "px";
        boton.style.top = newY + "px";
    }

    // **Reajustar la posici√≥n si la pantalla cambia de tama√±o**
    window.addEventListener("resize", function () {
        let savedPosition = localStorage.getItem("botonFlotantePos");
        if (savedPosition) {
            let { top, left } = JSON.parse(savedPosition);
            ajustarPosicionBoton(boton, top, left);
        }
    });
});

async function contarResultadosPorLibro(query) {
  const datos = await fetchAllJsonData();
  if (!datos) return;

  countResultsContainer.innerHTML = ""; // Limpiar sidebar

  const normalizedQuery = query
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();

  let conteoPorLibro = {}; // Guardar cu√°ntas veces aparece en cada libro
  let resultadosPorLibro = {}; // Guardar los vers√≠culos encontrados
  let totalResultados = 0; // Variable para contar el total de ocurrencias

  Object.keys(datos).forEach(libro => {
    let count = 0;
    let resultados = [];

    Object.keys(datos[libro]).forEach(capitulo => {
      Object.entries(datos[libro][capitulo]).forEach(([versiculo, texto]) => {
        const textoNormalizado = texto
          .normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
        const coincidencias = textoNormalizado.match(new RegExp(normalizedQuery, "g"));
        
        if (coincidencias) {
          count += coincidencias.length;
          totalResultados += coincidencias.length; // Sumar al total
          resultados.push({
            capitulo,
            versiculo
          });
        }
      });
    });

    if (count > 0) {
      conteoPorLibro[libro] = count;
      resultadosPorLibro[libro] = resultados;
    }
  });

  // **Mostrar el total de coincidencias en un nuevo cuadro**
  let totalContainer = `
    <div style="border: 2px solid black; padding: 10px; margin-bottom: 10px; background: #f8f9fa;">
      <strong>Busqueda:</strong> "${query}"<br>
      <strong>Total de coincidencias:</strong> ${totalResultados}
    </div>
  `;

  // **Mostrar los resultados por libro**
  countResultsContainer.innerHTML = totalContainer + Object.entries(conteoPorLibro)
    .map(([libro, count]) => 
      `<div class="libro-item">
        <a href="#" class="libro-link" onclick="toggleResultados('${libro}')">
          ${libro} (${count})
        </a>
        <div id="resultados-${libro}" class="resultados-libro" style="display:none;"></div>
      </div>`
    ).join("");
  
  window.resultadosPorLibro = resultadosPorLibro;
}


// Mostrar los enlaces de los vers√≠culos sin el texto
// Funci√≥n para manejar los clics en los vers√≠culos dentro de countResults
function toggleResultados(libro) {
    const resultadosDiv = document.getElementById(`resultados-${libro}`);

    if (resultadosDiv.style.display === "none") {
        resultadosDiv.style.display = "block";

        resultadosDiv.innerHTML = window.resultadosPorLibro[libro].map(({ capitulo, versiculo }) => 
            `<a href="#" class="versiculo-link" onclick="irAVersiculo('${libro}', '${capitulo}', '${versiculo}')">
                ${libro} ${capitulo}:${versiculo}
            </a>`
        ).join("<br>");
    } else {
        resultadosDiv.style.display = "none"; // Ocultar si ya est√° abierto
    }
}


// Funci√≥n para navegar al vers√≠culo seleccionado y mostrarlo en `results`
function irAVersiculo(libro, capitulo, versiculo) {
    fetchAllJsonData().then(datos => {
        if (!datos[libro] || !datos[libro][capitulo] || !datos[libro][capitulo][versiculo]) {
            resultsContainer.innerHTML = `<p>No se encontr√≥ el vers√≠culo.</p>`;
            return;
        }

        const textoVersiculo = datos[libro][capitulo][versiculo];

        resultsContainer.innerHTML = `
            <h2 id="tituloCapitulo">${libro} ${capitulo}</h2>
            <ul>
                <li>
                    <strong>${capitulo}:${versiculo}</strong> - ${textoVersiculo}
                    <button class="bookmark-btn" onclick="toggleSidebarBookmark()">
                        <i class="bi bi-bookmark"></i> <!-- üî• Icono de abrir/cerrar sidebar -->
                    </button>
                    <br>
                    <a href="#" class="full-chapter-link" onclick="showFullChapter('${libro}', '${capitulo}')">
                        Leer cap√≠tulo completo
                    </a>
                </li>
            </ul>
        `;

        searchInput.value = `${libro} ${capitulo}:${versiculo}`;
    });
}

// Funci√≥n para abrir/cerrar el sidebar
function toggleSidebarBookmark() {
    let sidebar = document.getElementById("sidebar");
    sidebar.classList.toggle("active"); // Alternar la clase para mostrar/ocultar
}



// Ocultar el bot√≥n al cargar la p√°gina
document.addEventListener("DOMContentLoaded", function () {
  let toggleBtn = document.querySelector(".toggle-btn");
  toggleBtn.style.display = "none"; // Inicia oculto
});

function controlarToggleBtn(query) {
  let toggleBtn = document.querySelector(".toggle-btn");

  // Verificar si el query contiene n√∫meros (indica cap√≠tulo o vers√≠culo)
  let contieneNumeros = /\d/.test(query);

  // Si la b√∫squeda es solo una palabra sin n√∫meros, mostramos el bot√≥n
  if (!contieneNumeros && query.trim().length > 0) {
    toggleBtn.style.display = "block"; // Mostrar bot√≥n
  } else {
    toggleBtn.style.display = "none"; // Ocultar bot√≥n
  }
}

// Modificar la funci√≥n de b√∫squeda para llamar a `controlarToggleBtn`
async function contarResultadosPorLibro(query) {
  const datos = await fetchAllJsonData();
  if (!datos) return;

  // Llamar a la funci√≥n para mostrar u ocultar el bot√≥n
  controlarToggleBtn(query);

  countResultsContainer.innerHTML = ""; // Limpiar sidebar

  const normalizedQuery = query
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();

  let conteoPorLibro = {}; // Guarda cu√°ntas veces aparece en cada libro
  let resultadosPorLibro = {}; // Guarda los vers√≠culos encontrados
  let totalResultados = 0; // Contador total de coincidencias

  Object.keys(datos).forEach(libro => {
    let count = 0;
    let resultados = [];

    Object.keys(datos[libro]).forEach(capitulo => {
      Object.entries(datos[libro][capitulo]).forEach(([versiculo, texto]) => {
        const textoNormalizado = texto
          .normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
        const coincidencias = textoNormalizado.match(new RegExp(normalizedQuery, "g"));
        
        if (coincidencias) {
          count += coincidencias.length;
          totalResultados += coincidencias.length; // Sumar al total
          resultados.push({
            capitulo,
            versiculo
          });
        }
      });
    });

    if (count > 0) {
      conteoPorLibro[libro] = count;
      resultadosPorLibro[libro] = resultados;
    }
  });

  // **Mostrar el total de coincidencias en un cuadro adicional**
  let totalContainer = `
    <div style="border: 2px solid black; padding: 10px; margin-bottom: 10px; background: #f8f9fa;">
      <strong>Palabra buscada:</strong> "${query}"<br>
      <strong>Total de coincidencias:</strong> ${totalResultados}
    </div>
  `;

  // **Generar la lista de resultados por libro**
  let resultadosHTML = Object.entries(conteoPorLibro)
    .map(([libro, count]) => 
      `<div class="libro-item">
        <a href="#" class="libro-link" onclick="toggleResultados('${libro}')">
          ${libro} (${count})
        </a>
        <div id="resultados-${libro}" class="resultados-libro" style="display:none;"></div>
      </div>`
    ).join("");

  // **Actualizar el contenedor con el total y los resultados por libro**
  countResultsContainer.innerHTML = totalContainer + resultadosHTML;

  window.resultadosPorLibro = resultadosPorLibro;
}

document.addEventListener("DOMContentLoaded", function () {
    const fontSelector = document.getElementById("fontSelector");
    const fontSizeSelector = document.getElementById("fontSizeSelector");

    // üî• Cargar valores guardados o establecer valores por defecto
    const savedFont = localStorage.getItem("selectedFont") || "Arial";
    const savedFontSize = localStorage.getItem("selectedFontSize") || "14px";

    fontSelector.value = savedFont;
    fontSizeSelector.value = savedFontSize.replace("px", "");

    aplicarEstilos(); // Aplicar al cargar

    // üéØ Evento para cambiar la fuente
    fontSelector.addEventListener("change", function () {
        localStorage.setItem("selectedFont", fontSelector.value);
        aplicarEstilos();
    });

    // üéØ Evento para cambiar el tama√±o de la fuente
    fontSizeSelector.addEventListener("change", function () {
        localStorage.setItem("selectedFontSize", fontSizeSelector.value + "px");
        aplicarEstilos();
    });

    // üî• Asegurar que los cambios persistan entre cap√≠tulos
    document.addEventListener("chapterChanged", aplicarEstilos);
});

// ‚úÖ Funci√≥n para aplicar los cambios a toda la interfaz
function aplicarEstilos() {
    const font = localStorage.getItem("selectedFont") || "Arial";
    const fontSize = localStorage.getItem("selectedFontSize") || "14px";

    // üî• Aplicar estilos a los vers√≠culos y otras secciones
    document.querySelectorAll("#results li, #contenidoBiblia, .settings-menu").forEach(el => {
        el.style.fontFamily = font;
        el.style.fontSize = fontSize;
    });
}



</script>
<script src="na28/js/na28movil.js"></script>
<script src="js/scriptparalelomovil.js"></script>
<!-- Bootstrap JS (aseg√∫rate de incluir Popper.js para tooltips) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  </body>
</html> 
