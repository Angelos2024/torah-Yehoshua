<!doctype html>
                            <head>
                                <meta charset='utf-8'>
                              
<meta name="viewport" content="width=device-width, initial-scale=1.0">

                                <title>Torah-con-yehoshúa'</title>
                                <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css' rel='stylesheet'>
                       
                            
                          

   <link rel="stylesheet" href="css/responsivemovil.css">


<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">


<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
      <link rel="stylesheet" href="css/estilosmovil.css">
  <script>
function checkScreenSize() {
    let width = Math.min(screen.width, window.innerWidth); // 📌 Toma el menor valor entre screen.width y window.innerWidth
    let userAgent = navigator.userAgent || navigator.vendor || window.opera;
    let currentPage = window.location.pathname.split("/").pop();
    let lastRedirect = sessionStorage.getItem("lastRedirect");

    // 📌 Detectar si es Chrome en iOS (importante porque a veces reporta mal el ancho)
    let isChromeiOS = /CriOS/.test(userAgent);

    if (isChromeiOS) {
        width = window.innerWidth; // En Chrome iOS, confiar en window.innerWidth
    }

    // 📌 Si la página es vacía (en GitHub Pages o servidores sin índice)
    if (currentPage === "" || currentPage === "index.html") {
        currentPage = "index.html";
    }

    // ✅ REDIRECCIÓN SEGURA
    if (width <= 991 && currentPage !== "versionmovil.html") {
        if (lastRedirect !== "versionmovil.html") {
            sessionStorage.setItem("lastRedirect", "versionmovil.html");
            window.location.href = "versionmovil.html";
        }
    } else if (width > 991 && currentPage !== "index.html") {
        if (lastRedirect !== "index.html") {
            sessionStorage.setItem("lastRedirect", "index.html");
            window.location.href = "index.html";
        }
    }
}

// 🔥 Ejecutar al cargar la página
window.addEventListener("DOMContentLoaded", checkScreenSize);

// 📌 Optimizar detección en cambios de tamaño de pantalla
let resizeTimer;
window.addEventListener("resize", function () {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(checkScreenSize, 200); // Evita redirecciones múltiples
});

</script>



</head>
<body>
    <div id="fixedHeaderContainer">
    <div class="header">
        <h4>Buscador Bíblico</h4>
        <div class="header-icons">
            <i class="fas fa-cog"></i>
            <i class="fas fa-ellipsis-v"></i>
        </div>
    </div>
    <div class="search-bar-container">
                <button class="btn btn-success" id="OpenMod">
            <i class="fas fa-book" id="dropdownMenu"></i>
        </button>
    <div class="search-bar">
        <input type="text" id="searchInput" class="form-control" placeholder="Escribe tu búsqueda...">
        <button class="btn btn-success" id="searchButton">
        </button>
    </div>


     

   <div id="fullscreenModal" class="fullscreen-modal">
    <div class="modal-content-custom">
        <div id="librosContainer">
            <a href="#" data-libro="Marcos">Según Marcos</a>
            <a href="#" data-libro="Romanos">Carta a los Romanos</a>
            <a href="#" data-libro="Gálatas">Carta a los Gálatas</a>
            <a href="#" data-libro="1Tesalonicenses">1 Tesalonicenses</a>
            <a href="#" data-libro="2Tesalonicenses">2 Tesalonicenses</a>
            <a href="#" data-libro="Hebreos">Carta a los Hebreos</a>
            <a href="#" data-libro="Apocalipsis">Revelación Apocalipsis</a>
        </div>
        
        <!-- Contenedor para mostrar los capítulos -->
        <div id="capitulosContainer" style="display: none;"></div>
        
        <button class="close-btn" id="closeModal">Cerrar</button>
    </div>
</div>


<div id="sidebarconteo">
    <div id="searchTermContainer" style="font-weight: bold; margin-bottom: 10px;"></div>
    <h5>Resultados</h5>
    <ul id="countResults" style="
        margin-top: -5px;
        list-style-type: none;
        padding: 0;
        margin-bottom: 10px;
        width: 100%;
    "></ul>
</div>

<!-- Botón para abrir/cerrar sidebar -->
<div class="toggle-btn" onclick="toggleSidebar()">☰</div>

<script>

    document.querySelector(".fa-cog").addEventListener("click", function() {
    this.classList.toggle("clicked");
});

    function toggleSidebar() {
        let sidebar = document.getElementById("sidebarconteo");
        sidebar.classList.toggle("active");
    }

    document.addEventListener("DOMContentLoaded", function () {
    let settingsIcon = document.querySelector(".fas.fa-cog");
    let settingsMenu = document.getElementById("settingsMenu");

    settingsIcon.addEventListener("click", function (event) {
        event.stopPropagation(); // Evita que el clic cierre el menú inmediatamente
        settingsMenu.style.display = (settingsMenu.style.display === "block") ? "none" : "block";
    });

    document.addEventListener("click", function (event) {
        if (!settingsMenu.contains(event.target) && event.target !== settingsIcon) {
            settingsMenu.style.display = "none";
        }
    });
});
function toggleNavigationButtons() {
    let isEnabled = document.getElementById("toggleNavButtons").checked;

    // Guardar preferencia en localStorage
    localStorage.setItem("navButtonsVisible", isEnabled);

    // Obtener los botones de navegación
    let buttons = document.querySelectorAll("#prevChapterBtn, #nextChapterBtn, #prevChapterBtnBottom, #nextChapterBtnBottom");

    buttons.forEach(button => {
        if (isEnabled) {
            button.style.position = "relative";  // Mostrar en su posición normal
            button.style.left = "0";  
            button.style.visibility = "visible"; 
            button.style.opacity = "1"; 
            button.style.pointerEvents = "auto"; // Permitir interacción
            button.style.transition = "opacity 0.3s ease-out";
        } else {
            button.style.position = "absolute"; // Ocultar fuera de pantalla
            button.style.left = "-9999px"; 
            button.style.visibility = "hidden"; 
            button.style.opacity = "0"; 
            button.style.pointerEvents = "none"; // Evitar clics
        }
    });
}


// Restaurar configuración al cargar la página
document.addEventListener("DOMContentLoaded", function () {
    let storedValue = localStorage.getItem("navButtonsVisible");

    // Si no hay valor guardado, activar por defecto
    let isEnabled = storedValue === null ? true : storedValue === "true";

    // Aplicar el estado del toggle en el checkbox
    document.getElementById("toggleNavButtons").checked = isEnabled;

    // Aplicar la configuración
    toggleNavigationButtons();
});



// Asegurar que se aplique al cambiar de capítulo
document.addEventListener("chapterChanged", toggleNavigationButtons);



</script>
 
         



<div class="settings-menu" id="settingsMenu">
    <label class="switch">
        <input type="checkbox" id="toggleNavButtons" onchange="toggleNavigationButtons()">
        <span class="slider"></span>
    </label>
    <span style="font-size: 14px;">Ver botones / Touch</span>

    <label for="fontSelector">Fuente:</label>
    <select id="fontSelector" class="config-dropdown">
        <option value="Arial">Arial</option>
        <option value="Verdana">Verdana</option>
        <option value="Times New Roman">Times New Roman</option>
    </select>

    <label for="fontSizeSelector">Tamaño:</label>
<select id="fontSizeSelector" class="config-dropdown">
    <option value="12">12</option>
    <option value="14">14</option>
    <option value="16">16</option>
    <option value="20">20</option>
</select>

</div>
<div class="settings-menu" id="menuOpciones">
    <h6>Opciones</h6>
    <label class="switch">
        <input type="checkbox" id="toggleDarkModeSwitch">
        <span class="slider round"></span>
    </label>
    <span style="font-size: 14px;">Modo Oscuro</span>
</div>

</div>

</div>


<script>
document.querySelector(".fa-ellipsis-v").addEventListener("click", function(event) {
    event.stopPropagation();
    let menu = document.getElementById("menuOpciones");
    menu.style.display = (menu.style.display === "block") ? "none" : "block";
});

document.addEventListener("click", function(event) {
    let menu = document.getElementById("menuOpciones");
    if (!menu.contains(event.target) && event.target !== document.querySelector(".fa-ellipsis-v")) {
        menu.style.display = "none";
    }
});

document.getElementById("toggleDarkModeSwitch").addEventListener("change", function() {
    document.body.classList.toggle("dark-mode");

    let header = document.querySelector(".header");
    let botones = document.querySelectorAll("button.btn-success, .toggle-btn");

    if (document.body.classList.contains("dark-mode")) {
        header.style.backgroundColor = "#222";
        header.style.color = "#fff";
        botones.forEach(btn => {
            btn.style.backgroundColor = "#000";
            btn.style.color = "#fff";
            btn.style.border = "1px solid #fff";
        });
        localStorage.setItem("modoOscuro", "true"); // Guardar preferencia
    } else {
        header.style.backgroundColor = "";
        header.style.color = "";
        botones.forEach(btn => {
            btn.style.backgroundColor = "";
            btn.style.color = "";
            btn.style.border = "";
        });
        localStorage.setItem("modoOscuro", "false"); // Guardar preferencia
    }
});

document.addEventListener("DOMContentLoaded", function () {
    let modoOscuroActivo = localStorage.getItem("modoOscuro") === "true";
    let switchModoOscuro = document.getElementById("toggleDarkModeSwitch");

    if (modoOscuroActivo) {
        document.body.classList.add("dark-mode");
        switchModoOscuro.checked = true;

        let header = document.querySelector(".header");
        let botones = document.querySelectorAll("button.btn-success, .toggle-btn");

        header.style.backgroundColor = "#222";
        header.style.color = "#fff";
        botones.forEach(btn => {
            btn.style.backgroundColor = "#000";
            btn.style.color = "#fff";
            btn.style.border = "1px solid #fff";
        });
    }
});



</script>

<!-- Resultados -->

    <ul id="results" style="margin-top:130px !important; padding-bottom:80px; background-color:#e5ddd5;" class="list-group col-12 mt-3">
    </ul>

<div id="sidebar">
    <h5>NA28</h5>
    <p>Aquí irá el contenido del aparato critico de cada verso disponible, busca algun verso que te interese y si encuentras     <i class="bi bi-bookmark"></i> solo da click para leerlo. </p>
    <br>
    <p>📖 La NA28 (Nestle-Aland 28) es una edición del Nuevo Testamento en griego, usada por académicos y traductores para estudiar el texto original de la Biblia. Es considerada una de las versiones más precisas, ya que se basa en los manuscritos más antiguos y confiables.  </p>

    <br>
    <br>
    <br>
</div>
<div id="sidebarparalelo">
  <h5>Biblia Paralela</h5> <!-- Botón para ocultar/mostrar búsqueda -->
<!-- Botón para ocultar/mostrar búsqueda -->
<button id="toggleSearchOptions" class="toggle-btn-sidebar">
    <i class="fas fa-chevron-up"></i>
</button>

<!-- Contenedor de los filtros de búsqueda -->
<div id="searchOptionsContainer">
    <label for="versionSelect">Versión:</label>
    <select id="versionSelect">
        <option value="RVR1960">RVR1960</option>
        <option value="BTX4">BTX4</option>
    </select>

    <label for="libroSelect">Libro:</label>
    <select id="libroSelect">
        <option value="">-- Elige versión primero --</option>
    </select>

    <label for="capituloSelect">Capítulo:</label>
    <select id="capituloSelect">
        <option value="">-- Elige libro primero --</option>
    </select>

    <!-- Botones de búsqueda y sincronización -->
    <button id="btnCargar">Buscar</button>
    <button id="btnSync">Sincronizar</button>
</div>

<!-- Este div SIEMPRE estará visible -->
<div id="contenidoBiblia" style="margin-top:20px;"></div>

</div>

<div id="sidebarcomentarios">
<div id="contenedorComentarios">
        <p id="mensajeNoComentarios">No hay comentarios</p>
    </div>
</div>

    
       <div class="bottom-nav">
    <a href="https://www.torah-con-yehoshua-hamashiaj.com" class="nav-item">
        <i class="fas fa-home"></i>
        <span>Inicio</span>
    </a>

    <a href="#" id="imgMaterial" class="nav-item">
        <i class="fas fa-book"></i>
        <span>Aparato Crítico</span>
    </a>

    <a href="#" id="toggleComentarios" class="nav-item">
        <i class="fas fa-message"></i>
        <span>Comentarios</span>
    </a>

    <a href="#" id="sidebar2" class="nav-item">
        <i class="fas fa-book-open"></i>
        <span>Biblia Paralela</span>
    </a>
</div>

    
    <div class="floating-button" id="flotante" style="z-index: 1001;">
        <i class="fas fa-plus"></i>
    </div>


  <!-- Mensaje de bienvenida -->
<div id="welcomeMessage" class="col-12 text-center mb-4">
  <h2>¡Bienvenido al Buscador de Versículos Bíblicos!</h2>
  <p>Escribe el libro, capítulo y versículo que deseas buscar.</p>
   <H7>(acepta abreviaciones y varios versos "gal 2:4-6"<br> "heb 1" o palabras de busqueda "israel")</H7>
   <br>
   <h6>Basado en los escritos de Eric de Jesús Rodríguez Mendoza</h6>
</div>

   <script src="js/cargarcomentariosmovil.js"></script>
        <script>


document.getElementById("sidebar2").addEventListener("click", function(e) {
    e.preventDefault(); // Evita que el enlace provoque scroll
    let sidebar = document.getElementById("sidebarparalelo");
    sidebar.classList.toggle("active");
});




document.addEventListener("DOMContentLoaded", function () {
    let boton = document.getElementById("flotante");
    let menu = document.querySelector(".bottom-nav");

    boton.addEventListener("click", function () {
        menu.classList.toggle("hidden"); // Alternar clase para ocultar/mostrar
    });
});




            /* codigo del menu de libros*/
        document.getElementById("OpenMod").addEventListener("click", function() {
            document.getElementById("fullscreenModal").style.display = "flex";
        });

       document.getElementById("closeModal").addEventListener("click", function() {
    document.getElementById("fullscreenModal").style.display = "none";
});

// Evento para abrir el modal y resetear la vista
document.getElementById("OpenMod").addEventListener("click", () => {
    let modal = document.getElementById("fullscreenModal");
    let librosContainer = document.getElementById("librosContainer");
    let capitulosContainer = document.getElementById("capitulosContainer");

    // Restaurar la vista inicial
    librosContainer.style.display = "block";  // Mostrar la lista de libros
    capitulosContainer.style.display = "none"; // Ocultar los capítulos previos

    // Mostrar el modal
    modal.style.display = "flex";
});

// Manejar la selección de libros y mostrar capítulos
document.querySelectorAll(".modal-content-custom a").forEach(item => {
    item.addEventListener("click", async function(event) {
        event.preventDefault(); // Evitar recarga

        let libroSeleccionado = this.dataset.libro;
        let capitulosContainer = document.getElementById("capitulosContainer");
        let librosContainer = document.getElementById("librosContainer");

        // Cargar los datos si aún no se han descargado
        await fetchAllJsonData();
        
        // Verificar si el libro existe en los datos cargados
        if (!bibliaDatos[libroSeleccionado]) {
            capitulosContainer.innerHTML = `<p>No se encontraron capítulos para ${libroSeleccionado}.</p>`;
            return;
        }

        // Ocultar la lista de libros y mostrar la de capítulos
        librosContainer.style.display = "none";
        capitulosContainer.style.display = "block";

        // Generar la lista de capítulos
        let fragment = document.createDocumentFragment();
        Object.keys(bibliaDatos[libroSeleccionado]).forEach(capitulo => {
            let button = document.createElement("button");
            button.textContent = `Capítulo ${capitulo}`;
            button.classList.add("capitulo-btn");
            button.addEventListener("click", () => {
                showFullChapter(libroSeleccionado, capitulo);
                
                // Cerrar el modal al seleccionar un capítulo
                document.getElementById("fullscreenModal").style.display = "none";
            });
            fragment.appendChild(button);
        });

        // Limpiar y agregar los capítulos al modal
        capitulosContainer.innerHTML = "";
        capitulosContainer.appendChild(fragment);

        // Agregar un botón para volver a la lista de libros
        let backButton = document.createElement("button");
        backButton.textContent = "← Volver a libros";
        backButton.classList.add("back-btn");
        backButton.addEventListener("click", () => {
            capitulosContainer.style.display = "none";
            librosContainer.style.display = "block";
        });

        capitulosContainer.appendChild(backButton);
    });
});


document.addEventListener("DOMContentLoaded", () => {
    let touchStartX = 0;
    let touchEndX = 0;
    let isSwipeAllowed = false;

    function checkSwipe() {
        if (!currentBook || !currentChapter || !isSwipeAllowed) return;

        let prevButton = document.getElementById("prevChapterBtn");
        let nextButton = document.getElementById("nextChapterBtn");

        let prevVisible = prevButton && prevButton.style.display !== "none";
        let nextVisible = nextButton && nextButton.style.display !== "none";

        if (touchStartX - touchEndX > 50 && nextVisible) {
            showNextChapter();
        } else if (touchEndX - touchStartX > 50 && prevVisible) {
            showPreviousChapter();
        }
    }

    document.getElementById("results").addEventListener("touchstart", (e) => {
        // Si el toque inicial es dentro de #results, permitir swipe
        touchStartX = e.changedTouches[0].screenX;
        isSwipeAllowed = true;
    });

    document.getElementById("results").addEventListener("touchend", (e) => {
        if (!isSwipeAllowed) return;
        touchEndX = e.changedTouches[0].screenX;
        checkSwipe();
    });

    // Evitar que el swipe funcione en sidebar abiertos
    document.getElementById("sidebarcomentarios").addEventListener("touchstart", () => isSwipeAllowed = false);
    document.getElementById("sidebarparalelo").addEventListener("touchstart", () => isSwipeAllowed = false);
    document.getElementById("sidebar").addEventListener("touchstart", () => isSwipeAllowed = false);
});


        async function mostrarCapitulos(libro) {
  const datos = await fetchAllJsonData();
  if (!datos[libro]) return;
  
  let capitulosHtml = Object.keys(datos[libro])
    .map(cap => `<a href="#" onclick="showFullChapter('${libro}', '${cap}')">Capítulo ${cap}</a>`)
    .join("");

  document.getElementById("results").innerHTML = `<div class="chapter-list">${capitulosHtml}</div>`;
}
    </script>
 <script>

// URLs de los JSONs
const urls = [
  "https://raw.githubusercontent.com/Angelos2024/torah-Yehoshua/main/Marcos.json",
  "https://raw.githubusercontent.com/Angelos2024/torah-Yehoshua/main/galatas.json",
  "https://raw.githubusercontent.com/Angelos2024/torah-Yehoshua/main/Hebreos.json",
  "https://raw.githubusercontent.com/Angelos2024/torah-Yehoshua/main/1_Tesalonicenses.json",
  "https://raw.githubusercontent.com/Angelos2024/torah-Yehoshua/main/2_Tesalonicenses.json",
  "https://raw.githubusercontent.com/Angelos2024/torah-Yehoshua/main/Romanos.json",
  "https://raw.githubusercontent.com/Angelos2024/torah-Yehoshua/main/Apocalipsis.json"
];

// Elementos del DOM
const searchInput = document.getElementById("searchInput");
const searchButton = document.getElementById("searchButton");
const resultsContainer = document.getElementById("results");
const countResultsContainer = document.getElementById("countResults");

// Cargar todos los JSONs en memoria
let bibliaDatos = {};

async function fetchJsonData(url) {
  try {
    const response = await fetch(url);
    if (!response.ok) throw new Error(`Error al cargar JSON: ${response.status}`);
    return await response.json();
  } catch (error) {
    console.error(`Error:`, error);
    return null;
  }
}

async function fetchAllJsonData() {
  if (Object.keys(bibliaDatos).length) return bibliaDatos; // Usa caché si ya está cargado
  const responses = await Promise.all(urls.map(url => fetchJsonData(url)));
  responses.forEach(data => { if (data) Object.assign(bibliaDatos, data); });
  return bibliaDatos;
}


// Mapa de abreviaturas de libros
const libroMap = {
   gal: "gálatas", Gal: "Gálatas",
   "galatas": "Gálatas", "Galatas":"Gálatas", "galatas": "Gálatas",
    heb: "hebreos", Heb: "Hebreos", "hebreos": "Hebreos", "Hebreos": "Hebreos", "HEBREOS":"Hebreos",
    "1 tes": "1Tesalonicenses", "1tes": "1Tesalonicenses",
    "1 tesa": "1Tesalonicenses", "1Tesa": "1Tesalonicenses",
    "1 tesalonicenses": "1Tesalonicenses", 
    "2 tes": "2Tesalonicenses", "2tes": "2Tesalonicenses",
    "2 tesa": "2Tesalonicenses", "2Tesa": "2Tesalonicenses",
    "2 tesalonicenses": "2Tesalonicenses",
    "Romanos": "Romanos", "romanos": "Romanos", "Rom": "Romanos", "rom": "Romanos", "ROMANOS":"Romanos", "ROM": "Romanos", "Marcos": "Marcos", "marcos":"Marcos", "MARCOS":"Marcos", "marc": "Marcos", "Mc": "Marcos", "Mar":"Marcos", "MAR": "Marcos", "mar":"Marcos", "Ap": "Apocalipsis", "ap":"Apocalipsis", "apocalipsis":"Apocalipsis", "APOCALIPSIS":"Apocalipsis", "Apoc":"Apocalipsis", "apoc":"Apocalipsis", "APOC":"Apocalipsis","AP":"Apocalipsis"
  };

// 🔥 Variables globales para la versión principal
let currentBook = null;
let currentChapter = null;

// Función de búsqueda
async function searchVerses(query) {
    if (!query || typeof query !== "string") {
        console.error("searchVerses: query es inválido", query);
        return;
    }
// 🔥 OCULTAR el mensaje de bienvenida
    document.getElementById("welcomeMessage").style.display = "none";
  
    const datos = await fetchAllJsonData();
    if (!datos) return;

    // 🔥 Resetear contenedores
    resultsContainer.innerHTML = "";
    countResultsContainer.innerHTML = "";

    let tituloCapitulo = document.getElementById("tituloCapitulo");
    if (tituloCapitulo) {
        tituloCapitulo.style.display = "none"; 
    }

    const normalizedQuery = query
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();

    // 🔹 Expresión regular para detectar citas de versículos (Ej: "Gálatas 1:4" o "Gal 2:3-8")
    const regexCita = /^([\w\s]+)\s(\d+)(?::(\d+)(?:-(\d+))?)?$/;
    const match = normalizedQuery.match(regexCita);

    if (match) {
        let libro = match[1].trim();
        const capitulo = match[2];
        const versiculoInicio = match[3];
        const versiculoFin = match[4];

        libro = libroMap[libro] || libro; // Convertir abreviaturas ("Gal" -> "Gálatas")

        const libroEncontrado = Object.keys(datos).find(key =>
            key.toLowerCase() === libro.toLowerCase()
        );

        if (libroEncontrado && datos[libroEncontrado][capitulo]) {
            let versos = datos[libroEncontrado][capitulo];

            // Si hay un versículo específico
            if (versiculoInicio) {
                let versiculos = [];

                // Si es un rango (Ej: Gálatas 1:3-8)
                if (versiculoFin) {
                    for (let i = parseInt(versiculoInicio); i <= parseInt(versiculoFin); i++) {
                        if (versos[i]) {
                            versiculos.push(`<li><strong>${libro} ${capitulo}:${i}</strong> - ${versos[i]}</li>`);
                        }
                    }
                } else {
                    // Solo un versículo específico (Ej: Gálatas 1:4)
                    if (versos[versiculoInicio]) {
                        versiculos.push(`<li><strong>${libro} ${capitulo}:${versiculoInicio}</strong> - ${versos[versiculoInicio]}</li>`);
                    }
                }

                // 🔥 Agregar el enlace para leer el capítulo completo con el **evento correctamente asignado**
                versiculos.push(`
                    <li>
                        <a href="#" class="full-chapter-link" data-libro="${libroEncontrado}" data-capitulo="${capitulo}">
                            📖 Leer capítulo completo
                        </a>
                    </li>
                `);

                resultsContainer.innerHTML = versiculos.length > 0
                    ? versiculos.join("")
                    : `<li>No se encontraron resultados.</li>`;

                // 🔥 Agregar el evento dinámicamente
                setTimeout(() => asignarEventosCapituloCompleto(), 100);

                return; // 🔥 Evita que siga buscando por palabras
            }

            // 🔥 Si no hay versículo, mostrar el capítulo completo
            currentBook = libroEncontrado;
            currentChapter = parseInt(capitulo, 10);
            showFullChapter(libroEncontrado, capitulo);
            return;
        }
    }

    // 🔹 Búsqueda por palabras (Ej: "israel", "gracia")
    try {
        const palabraRegex = new RegExp(`(${query})`, "gi");
        let resultados = [];

        Object.keys(datos).forEach(libro => {
            Object.keys(datos[libro]).forEach(capitulo => {
                Object.entries(datos[libro][capitulo]).forEach(([versiculo, texto]) => {
                    const textoNormalizado = texto
                        .normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
                    if (textoNormalizado.includes(normalizedQuery)) {
                        const textoResaltado = texto.replace(
                            palabraRegex,
                            "<span style='background-color: #ffeb3b; font-weight: bold;'>$1</span>"
                        );
                        resultados.push(
                            `<li>${libro} ${capitulo}:${versiculo} - ${textoResaltado}
                              <a href="#" class="full-chapter-link" data-libro="${libro}" data-capitulo="${capitulo}">
                                  📖 Leer capítulo completo
                              </a>
                            </li>`
                        );
                    }
                });
            });
        });

        resultsContainer.innerHTML = resultados.length > 0 ? resultados.join("") : "<li>No se encontraron coincidencias.</li>";

        // 🔥 Asignar eventos a los enlaces de "Leer capítulo completo"
        setTimeout(() => asignarEventosCapituloCompleto(), 100);
    } catch (error) {
        console.error("Error en palabraRegex:", error);
    }
}

// 📌 Función para asignar eventos a los enlaces "📖 Leer capítulo completo"
function asignarEventosCapituloCompleto() {
    document.querySelectorAll(".full-chapter-link").forEach(link => {
        link.addEventListener("click", function (e) {
            e.preventDefault();
            let libro = this.getAttribute("data-libro");
            let capitulo = this.getAttribute("data-capitulo");
            showFullChapter(libro, capitulo);
        });
    });
}



function showFullChapter(libro, capitulo) {
    fetchAllJsonData().then(datos => {
        if (!datos[libro] || !datos[libro][capitulo]) return;

        currentBook = libro;
        currentChapter = parseInt(capitulo, 10);

        const versiculos = Object.entries(datos[libro][capitulo])
            .map(([versiculo, texto]) => {
                const claveMapa = `${libro} ${capitulo}:${versiculo}`;

                const botonBookmark = na28Map[claveMapa]
                    ? `<button class="bookmark-btn" onclick="cargarNA28('${libro}', '${capitulo}', '${versiculo}')">
                           <i class="bi bi-bookmark"></i>
                       </button>`
                    : "";

                return `<li><span>${versiculo}. ${texto}</span>${botonBookmark}</li>`;
            })
            .join("");

        resultsContainer.innerHTML = `
            <div class="chapter-navigation">
                <button id="prevChapterBtn" onclick="showPreviousChapter()">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button id="nextChapterBtn" onclick="showNextChapter()">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <h2 id="tituloCapitulo">${libro} ${capitulo}</h2>
            <ul>${versiculos}</ul>
<div class="chapter-navigation">
                <button id="prevChapterBtnBottom" onclick="showPreviousChapter()">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button id="nextChapterBtnBottom" onclick="showNextChapter()">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        `;

        document.getElementById("tituloCapitulo").style.display = "block";
        toggleNavigationButtons();
        cargarComentariosCapitulo(libro, capitulo);
        aplicarEstilos(); // 🔥 Aplicar estilos después de cambiar el contenido
    });
}








function showPreviousChapter() {
    fetchAllJsonData().then(datos => {
        if (!currentBook || !currentChapter) return;
        let prevChapter = (currentChapter - 1).toString();

        if (datos[currentBook][prevChapter]) {
            showFullChapter(currentBook, prevChapter);
        }
    });
}

function showNextChapter() {
    fetchAllJsonData().then(datos => {
        if (!currentBook || !currentChapter) return;
        let nextChapter = (currentChapter + 1).toString();

        if (datos[currentBook][nextChapter]) {
            showFullChapter(currentBook, nextChapter);
        }
    });
}



function updateNavigationButtons(datos) {
    let prevButton = document.getElementById("prevChapterBtn");
    let nextButton = document.getElementById("nextChapterBtn");
    let prevButtonBottom = document.getElementById("prevChapterBtnBottom");
    let nextButtonBottom = document.getElementById("nextChapterBtnBottom");

    let prevChapter = (currentChapter - 1).toString();
    let nextChapter = (currentChapter + 1).toString();

    console.log(`Libro actual: ${currentBook}, Capítulo actual: ${currentChapter}`);
    console.log(`Capítulo anterior: ${prevChapter}, Capítulo siguiente: ${nextChapter}`);

    // Si hay un capítulo anterior, mostrar botones prev
    if (datos[currentBook][prevChapter]) {
        prevButton.style.display = "inline-block";
        prevButtonBottom.style.display = "inline-block";
    } else {
        prevButton.style.display = "none";
        prevButtonBottom.style.display = "none";
    }

    // Si hay un capítulo siguiente, mostrar botones next
    if (datos[currentBook][nextChapter]) {
        nextButton.style.display = "inline-block";
        nextButtonBottom.style.display = "inline-block";
    } else {
        nextButton.style.display = "none";
        nextButtonBottom.style.display = "none";
    }
}


// Eventos para la búsqueda
searchButton.addEventListener("click", () => {
  const query = searchInput.value.trim();
  if (query) {
    searchVerses(query);
    contarResultadosPorLibro(query); // Llamar a la función de conteo
  }
});

searchInput.addEventListener("keypress", event => {
  if (event.key === "Enter") {
    const query = searchInput.value.trim();
    if (query) {
      searchVerses(query);
      contarResultadosPorLibro(query); // Llamar a la función de conteo
    }
  }
});


</script>
<script>
document.getElementById("imgMaterial").addEventListener("click", function(e) {
    e.preventDefault();
    let sidebar = document.getElementById("sidebar");
    sidebar.classList.toggle("active");
});

</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    let boton = document.getElementById("flotante");
    let offsetX, offsetY, dragging = false;

    // Cargar la última posición guardada y ajustarla si está fuera de la pantalla
    let savedPosition = localStorage.getItem("botonFlotantePos");
    if (savedPosition) {
        let { top, left } = JSON.parse(savedPosition);
        ajustarPosicionBoton(boton, top, left);
    }

    boton.addEventListener("touchstart", startDrag, false);
    boton.addEventListener("touchmove", drag, false);
    boton.addEventListener("touchend", stopDrag, false);

    boton.addEventListener("mousedown", startDrag, false);
    document.addEventListener("mousemove", drag, false);
    document.addEventListener("mouseup", stopDrag, false);

    function startDrag(e) {
        dragging = true;
        let event = e.type.includes("touch") ? e.touches[0] : e;
        offsetX = event.clientX - boton.getBoundingClientRect().left;
        offsetY = event.clientY - boton.getBoundingClientRect().top;
        boton.style.transition = "none"; // Quita la animación al arrastrar
    }

    function drag(e) {
        if (!dragging) return;
        let event = e.type.includes("touch") ? e.touches[0] : e;
        let x = event.clientX - offsetX;
        let y = event.clientY - offsetY;

        ajustarPosicionBoton(boton, y, x);
    }

    function stopDrag() {
        if (!dragging) return;
        dragging = false;
        boton.style.transition = "all 0.2s ease-out"; // Animación suave al soltar

        // Guardar la nueva posición en localStorage
        let position = {
            top: boton.offsetTop,
            left: boton.offsetLeft
        };
        localStorage.setItem("botonFlotantePos", JSON.stringify(position));
    }

    // **Función para evitar que el botón quede fuera de la pantalla**
    function ajustarPosicionBoton(boton, top, left) {
        let maxX = window.innerWidth - boton.clientWidth - 10; // Margen de 10px
        let maxY = window.innerHeight - boton.clientHeight - 10;

        let newX = Math.max(10, Math.min(left, maxX)); // Evita salir por izquierda/derecha
        let newY = Math.max(10, Math.min(top, maxY));  // Evita salir por arriba/abajo

        boton.style.left = newX + "px";
        boton.style.top = newY + "px";
    }

    // **Reajustar la posición si la pantalla cambia de tamaño**
    window.addEventListener("resize", function () {
        let savedPosition = localStorage.getItem("botonFlotantePos");
        if (savedPosition) {
            let { top, left } = JSON.parse(savedPosition);
            ajustarPosicionBoton(boton, top, left);
        }
    });
});

async function contarResultadosPorLibro(query) {
  const datos = await fetchAllJsonData();
  if (!datos) return;

  countResultsContainer.innerHTML = ""; // Limpiar sidebar

  const normalizedQuery = query
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();

  let conteoPorLibro = {}; // Guardar cuántas veces aparece en cada libro
  let resultadosPorLibro = {}; // Guardar los versículos encontrados
  let totalResultados = 0; // Variable para contar el total de ocurrencias

  Object.keys(datos).forEach(libro => {
    let count = 0;
    let resultados = [];

    Object.keys(datos[libro]).forEach(capitulo => {
      Object.entries(datos[libro][capitulo]).forEach(([versiculo, texto]) => {
        const textoNormalizado = texto
          .normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
        const coincidencias = textoNormalizado.match(new RegExp(normalizedQuery, "g"));
        
        if (coincidencias) {
          count += coincidencias.length;
          totalResultados += coincidencias.length; // Sumar al total
          resultados.push({
            capitulo,
            versiculo
          });
        }
      });
    });

    if (count > 0) {
      conteoPorLibro[libro] = count;
      resultadosPorLibro[libro] = resultados;
    }
  });

  // **Mostrar el total de coincidencias en un nuevo cuadro**
  let totalContainer = `
    <div style="border: 2px solid black; padding: 10px; margin-bottom: 10px; background: #f8f9fa;">
      <strong>Busqueda:</strong> "${query}"<br>
      <strong>Total de coincidencias:</strong> ${totalResultados}
    </div>
  `;

  // **Mostrar los resultados por libro**
  countResultsContainer.innerHTML = totalContainer + Object.entries(conteoPorLibro)
    .map(([libro, count]) => 
      `<div class="libro-item">
        <a href="#" class="libro-link" onclick="toggleResultados('${libro}')">
          ${libro} (${count})
        </a>
        <div id="resultados-${libro}" class="resultados-libro" style="display:none;"></div>
      </div>`
    ).join("");
  
  window.resultadosPorLibro = resultadosPorLibro;
}


// Mostrar los enlaces de los versículos sin el texto
// Función para manejar los clics en los versículos dentro de countResults
function toggleResultados(libro) {
    const resultadosDiv = document.getElementById(`resultados-${libro}`);

    if (resultadosDiv.style.display === "none") {
        resultadosDiv.style.display = "block";

        resultadosDiv.innerHTML = window.resultadosPorLibro[libro].map(({ capitulo, versiculo }) => 
            `<a href="#" class="versiculo-link" onclick="irAVersiculo('${libro}', '${capitulo}', '${versiculo}')">
                ${libro} ${capitulo}:${versiculo}
            </a>`
        ).join("<br>");
    } else {
        resultadosDiv.style.display = "none"; // Ocultar si ya está abierto
    }
}


// Función para navegar al versículo seleccionado y mostrarlo en `results`
function irAVersiculo(libro, capitulo, versiculo) {
    fetchAllJsonData().then(datos => {
        if (!datos[libro] || !datos[libro][capitulo] || !datos[libro][capitulo][versiculo]) {
            resultsContainer.innerHTML = `<p>No se encontró el versículo.</p>`;
            return;
        }

        const textoVersiculo = datos[libro][capitulo][versiculo];

        resultsContainer.innerHTML = `
            <h2 id="tituloCapitulo">${libro} ${capitulo}</h2>
            <ul>
                <li>
                    <strong>${capitulo}:${versiculo}</strong> - ${textoVersiculo}
                    <button class="bookmark-btn" onclick="toggleSidebarBookmark()">
                        <i class="bi bi-bookmark"></i> <!-- 🔥 Icono de abrir/cerrar sidebar -->
                    </button>
                    <br>
                    <a href="#" class="full-chapter-link" onclick="showFullChapter('${libro}', '${capitulo}')">
                        Leer capítulo completo
                    </a>
                </li>
            </ul>
        `;

        searchInput.value = `${libro} ${capitulo}:${versiculo}`;
    });
}

// Función para abrir/cerrar el sidebar
function toggleSidebarBookmark() {
    let sidebar = document.getElementById("sidebar");
    sidebar.classList.toggle("active"); // Alternar la clase para mostrar/ocultar
}



// Ocultar el botón al cargar la página
document.addEventListener("DOMContentLoaded", function () {
  let toggleBtn = document.querySelector(".toggle-btn");
  toggleBtn.style.display = "none"; // Inicia oculto
});

function controlarToggleBtn(query) {
  let toggleBtn = document.querySelector(".toggle-btn");

  // Verificar si el query contiene números (indica capítulo o versículo)
  let contieneNumeros = /\d/.test(query);

  // Si la búsqueda es solo una palabra sin números, mostramos el botón
  if (!contieneNumeros && query.trim().length > 0) {
    toggleBtn.style.display = "block"; // Mostrar botón
  } else {
    toggleBtn.style.display = "none"; // Ocultar botón
  }
}

// Modificar la función de búsqueda para llamar a `controlarToggleBtn`
async function contarResultadosPorLibro(query) {
  const datos = await fetchAllJsonData();
  if (!datos) return;

  // Llamar a la función para mostrar u ocultar el botón
  controlarToggleBtn(query);

  countResultsContainer.innerHTML = ""; // Limpiar sidebar

  const normalizedQuery = query
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();

  let conteoPorLibro = {}; // Guarda cuántas veces aparece en cada libro
  let resultadosPorLibro = {}; // Guarda los versículos encontrados
  let totalResultados = 0; // Contador total de coincidencias

  Object.keys(datos).forEach(libro => {
    let count = 0;
    let resultados = [];

    Object.keys(datos[libro]).forEach(capitulo => {
      Object.entries(datos[libro][capitulo]).forEach(([versiculo, texto]) => {
        const textoNormalizado = texto
          .normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
        const coincidencias = textoNormalizado.match(new RegExp(normalizedQuery, "g"));
        
        if (coincidencias) {
          count += coincidencias.length;
          totalResultados += coincidencias.length; // Sumar al total
          resultados.push({
            capitulo,
            versiculo
          });
        }
      });
    });

    if (count > 0) {
      conteoPorLibro[libro] = count;
      resultadosPorLibro[libro] = resultados;
    }
  });

  // **Mostrar el total de coincidencias en un cuadro adicional**
  let totalContainer = `
    <div style="border: 2px solid black; padding: 10px; margin-bottom: 10px; background: #f8f9fa;">
      <strong>Palabra buscada:</strong> "${query}"<br>
      <strong>Total de coincidencias:</strong> ${totalResultados}
    </div>
  `;

  // **Generar la lista de resultados por libro**
  let resultadosHTML = Object.entries(conteoPorLibro)
    .map(([libro, count]) => 
      `<div class="libro-item">
        <a href="#" class="libro-link" onclick="toggleResultados('${libro}')">
          ${libro} (${count})
        </a>
        <div id="resultados-${libro}" class="resultados-libro" style="display:none;"></div>
      </div>`
    ).join("");

  // **Actualizar el contenedor con el total y los resultados por libro**
  countResultsContainer.innerHTML = totalContainer + resultadosHTML;

  window.resultadosPorLibro = resultadosPorLibro;
}

document.addEventListener("DOMContentLoaded", function () {
    const fontSelector = document.getElementById("fontSelector");
    const fontSizeSelector = document.getElementById("fontSizeSelector");

    // 🔥 Cargar valores guardados o establecer valores por defecto
    const savedFont = localStorage.getItem("selectedFont") || "Arial";
    const savedFontSize = localStorage.getItem("selectedFontSize") || "14px";

    fontSelector.value = savedFont;
    fontSizeSelector.value = savedFontSize.replace("px", "");

    aplicarEstilos(); // Aplicar al cargar

    // 🎯 Evento para cambiar la fuente
    fontSelector.addEventListener("change", function () {
        localStorage.setItem("selectedFont", fontSelector.value);
        aplicarEstilos();
    });

    // 🎯 Evento para cambiar el tamaño de la fuente
    fontSizeSelector.addEventListener("change", function () {
        localStorage.setItem("selectedFontSize", fontSizeSelector.value + "px");
        aplicarEstilos();
    });

    // 🔥 Asegurar que los cambios persistan entre capítulos
    document.addEventListener("chapterChanged", aplicarEstilos);
});

// ✅ Función para aplicar los cambios a toda la interfaz
// ✅ Función para aplicar los cambios a toda la interfaz
function aplicarEstilos() {
    const font = localStorage.getItem("selectedFont") || "Arial";
    const fontSize = localStorage.getItem("selectedFontSize") || "14px";

    // 🔹 Aplicar estilos SOLO a los versículos y otras secciones (excluyendo settingsMenu)
    document.querySelectorAll("#results li, #contenidoBiblia, .list-group").forEach(el => {
        el.style.fontFamily = font;
        el.style.fontSize = fontSize;
    });

    // 🔥 EXCLUSIÓN: NO aplicar cambios en settingsMenu
    document.querySelector("#settingsMenu").style.fontFamily = "Arial";
    document.querySelector("#settingsMenu").style.fontSize = "14px";
}





</script>


  <script>
document.addEventListener("DOMContentLoaded", function () {
    // 🔥 Resizers para cada panel
    agregarResizer("sidebar");          // Aparato Crítico
    agregarResizer("sidebarcomentarios"); // Comentarios
    agregarResizer("sidebarparalelo");  // Biblia Paralela
});

function agregarResizer(idPanel) {
    const panel = document.getElementById(idPanel);
    if (!panel) return;

    // 🔥 Crear el botón deslizante
    let resizer = document.createElement("div");
    resizer.classList.add("resizer");
    panel.appendChild(resizer);

    // 📌 Variables de control
    let isResizing = false;
    let startY, startHeight;

    // 📌 Eventos para comenzar a redimensionar
    resizer.addEventListener("mousedown", iniciarResizer);
    resizer.addEventListener("touchstart", iniciarResizer, { passive: false });

    function iniciarResizer(e) {
        e.preventDefault();
        isResizing = true;
        startY = e.touches ? e.touches[0].clientY : e.clientY;
        startHeight = panel.offsetHeight;

        // 📌 Detectar eventos globales de movimiento y soltar
        document.addEventListener("mousemove", ajustarAltura);
        document.addEventListener("mouseup", detenerResizer);
        document.addEventListener("touchmove", ajustarAltura, { passive: false });
        document.addEventListener("touchend", detenerResizer);
    }

    function ajustarAltura(e) {
        if (!isResizing) return;
        let currentY = e.touches ? e.touches[0].clientY : e.clientY;
        let newHeight = startHeight + (startY - currentY);

        // 📌 Limitar el tamaño mínimo y máximo
        if (newHeight > 100 && newHeight < window.innerHeight * 0.8) {
            panel.style.height = `${newHeight}px`;
            localStorage.setItem(`${idPanel}-height`, newHeight);
        }
    }

    function detenerResizer() {
        isResizing = false;
        document.removeEventListener("mousemove", ajustarAltura);
        document.removeEventListener("mouseup", detenerResizer);
        document.removeEventListener("touchmove", ajustarAltura);
        document.removeEventListener("touchend", detenerResizer);
    }

    // 📌 Cargar tamaño guardado si existe
    let savedHeight = localStorage.getItem(`${idPanel}-height`);
    if (savedHeight) {
        panel.style.height = `${savedHeight}px`;
    }
}


    document.addEventListener("DOMContentLoaded", function () {
    let selectedItems = new Set();

    // 📌 Detectar toque prolongado para seleccionar
    document.querySelectorAll("#results").forEach(resultsContainer => {
        resultsContainer.addEventListener("touchstart", (event) => {
            let target = event.target.closest("li"); // Detecta el <li> más cercano
            if (!target) return;

            let timeout = setTimeout(() => {
                toggleSelection(target);
            }, 500); // ⏳ Toque prolongado de 500ms para activar selección

            target.addEventListener("touchend", () => clearTimeout(timeout), { once: true });
            target.addEventListener("touchmove", () => clearTimeout(timeout), { once: true });
        });
    });

    // 📌 Función para alternar la selección de un versículo
    function toggleSelection(item) {
        if (selectedItems.has(item)) {
            selectedItems.delete(item);
            item.classList.remove("selected");
        } else {
            selectedItems.add(item);
            item.classList.add("selected");
        }

        if (selectedItems.size > 0) {
            showCopyOptions();
        } else {
            hideCopyOptions();
        }
    }

    // 📌 Mostrar opciones de copiar
    function showCopyOptions() {
        let toolbar = document.getElementById("copyToolbar");
        if (!toolbar) {
            toolbar = document.createElement("div");
            toolbar.id = "copyToolbar";
            toolbar.innerHTML = `
                <button id="copySelected">📋 Copiar</button>
                <button id="deselectAll">❌ Cancelar</button>
            `;
            document.body.appendChild(toolbar);

            document.getElementById("copySelected").addEventListener("click", copySelected);
            document.getElementById("deselectAll").addEventListener("click", clearSelection);
        }
        toolbar.style.display = "flex";
    }

    // 📌 Ocultar opciones de copiar
    function hideCopyOptions() {
        let toolbar = document.getElementById("copyToolbar");
        if (toolbar) toolbar.style.display = "none";
    }

    // 📌 Copiar texto seleccionado
    function copySelected() {
        const text = Array.from(selectedItems).map(item => item.innerText).join("\n");
        copyToClipboard(text);
    }

    // 📌 Función para copiar texto al portapapeles y mostrar mensaje temporal
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            showCopiedMessage(selectedItems.size === 1 ? "📋 Verso copiado" : "📋 Versos copiados");
            clearSelection();
        }).catch(err => console.error("Error al copiar:", err));
    }

    // 📌 Mostrar mensaje temporal de copiado
    function showCopiedMessage(message) {
        let msgBox = document.createElement("div");
        msgBox.className = "copy-message";
        msgBox.textContent = message;
        document.body.appendChild(msgBox);

        setTimeout(() => {
            msgBox.style.opacity = "0";
            setTimeout(() => msgBox.remove(), 300);
        }, 1000); // ⏳ Se oculta automáticamente en 1 segundo
    }

    // 📌 Limpiar selección
    function clearSelection() {
        selectedItems.forEach(item => item.classList.remove("selected"));
        selectedItems.clear();
        hideCopyOptions();
    }

    // 📌 Detectar clic fuera para cancelar selección
    document.addEventListener("click", (e) => {
        if (!e.target.closest("#results li") && !e.target.closest("#copyToolbar")) {
            clearSelection();
        }
    });
});

</script>

<style>
/* 🔥 Estilo para el botón deslizante */
.resizer {
    width: 100%;
    height: 10px;
    background: #075e54;
    cursor: ns-resize;
    position: absolute;
    top: -5px;
    left: 0;
}
</style>
<script src="na28/js/na28movil.js"></script>
<script src="js/scriptparalelomovil.js"></script>
<!-- Bootstrap JS (asegúrate de incluir Popper.js para tooltips) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  </body>
</html> 
